<ion-card>
  <ion-card-header class="header">
    <ion-avatar>
      <img [attr.alt]="'common.avatarAlt' | t" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
    </ion-avatar>
    <ion-label class="title-avatar">
      <h1>{{ 'home.welcome' | t:{ username: user.username } }}</h1>
    </ion-label>
  </ion-card-header>
</ion-card>

<div class="content">
  <ion-card *ngIf="!isProviderUser">
    <ion-card-header color="tertiary">
      <ion-card-title>{{ 'home.findProviderOrService' | t }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-segment [value]="searchMode" (ionChange)="onSearchModeChange($any($event.detail).value)">
        <ion-segment-button value="provider">
          <ion-label>{{ 'home.segment.provider' | t }}</ion-label>
        </ion-segment-button>
        <ion-segment-button value="service">
          <ion-label>{{ 'home.segment.service' | t }}</ion-label>
        </ion-segment-button>
      </ion-segment>

      <ion-searchbar [(ngModel)]="searchQuery"
                     (ionInput)="onSearchQueryChange($any($event.detail).value)"
                     [placeholder]="'home.searchPlaceholder' | t"></ion-searchbar>

      <ion-searchbar [(ngModel)]="searchLocation"
                     (ionInput)="onSearchLocationChange($any($event.detail).value)"
                     [placeholder]="'home.cityFilterPlaceholder' | t"></ion-searchbar>

      <ion-list *ngIf="showCitySuggestions" class="city-suggestions">
        <ion-item [button]="true" detail="false" *ngFor="let city of citySuggestions" (click)="selectCity(city)">
          <ion-label>{{ city }}</ion-label>
        </ion-item>
      </ion-list>

      <ion-item *ngIf="searchLocation.trim() && !selectedCity" lines="none" class="search-empty">
        <ion-label>{{ 'home.selectCityHint' | t }}</ion-label>
      </ion-item>

      <ion-list *ngIf="searchMode === 'provider' && searchHasResults">
        <ion-item *ngFor="let p of providerResults">
          <ion-label>
            <h2>{{ p.name }}</h2>
            <p>{{ p.description }}</p>
            <p *ngIf="p.services?.length">{{ 'home.servicesAvailable' | t:{ count: p.services.length } }}</p>
          </ion-label>
          <ion-button slot="end" (click)="openReservationByProvider(p)">
            {{ 'home.book' | t }}
          </ion-button>
        </ion-item>
      </ion-list>

      <ion-list *ngIf="searchMode === 'service' && searchHasResults">
        <ion-item *ngFor="let result of serviceResults">
          <ion-label>
            <h2>{{ result.service.name }}</h2>
            <p>{{ result.provider.name }}</p>
            <p *ngIf="result.service.description">{{ result.service.description }}</p>
          </ion-label>
          <ion-button slot="end" (click)="openReservationByService(result)">
            {{ 'home.book' | t }}
          </ion-button>
        </ion-item>
      </ion-list>

      <ion-item *ngIf="isSearching" lines="none" class="search-empty">
        <ion-label>{{ 'home.searching' | t }}</ion-label>
      </ion-item>

      <ion-item *ngIf="searchHasNoResults" lines="none" class="search-empty">
        <ion-label>{{ 'home.noResults' | t }}</ion-label>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <app-status-calendar *ngIf="isProviderUser"
                       [month]="providerCalendarMonth"
                       [monthLabel]="providerCurrentMonthLabel"
                       [weekDayKeys]="weekDayKeys"
                       [selectedDateIso]="providerSelectedDate"
                       [todayIsoDate]="todayIsoDate"
                       [dotLevelsByDate]="providerDotLevelsByDate"
                       [defaultDotLevel]="providerCalendarDefaultDotLevel"
                       [disabledWeekDays]="providerClosedWeekDays"
                       [disabledDatesIso]="providerClosedDatesIso"
                       [canGoToPreviousMonth]="canGoToPreviousProviderMonth"
                       (monthChange)="changeProviderMonth($event)"
                       (daySelected)="selectProviderReservationDay($event)"></app-status-calendar>

  <app-reservations-list [list]="user.reservations"
                         [filterBySelectedDate]="isProviderUser"
                         [filterDateIso]="providerSelectedDate"
                         (reservationRemoved)="onProviderReservationRemoved()"></app-reservations-list>

  <div class="provider-admin" *ngIf="provider">
      <ion-button expand="block" (click)="goToProviderAdmin()">{{ 'home.adminArea' | t }}</ion-button>
  </div>

</div>
