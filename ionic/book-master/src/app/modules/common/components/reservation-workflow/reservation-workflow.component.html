<ion-item *ngIf="currentStep !== 'provider'" lines="none" class="workflow-nav">
  <ion-button class="back-button" fill="clear" (click)="goBack()" [disabled]="!canGoBack" aria-label="Step precedente">
    <ion-icon name="chevron-back-outline"></ion-icon>
  </ion-button>

  <ion-label class="ion-text-center">{{ stepLabel }}</ion-label>
</ion-item>

<app-providers-list *ngIf="currentStep === 'provider'" (selected)="providerSelected($event)"></app-providers-list>

<app-object-profile *ngIf="currentStep === 'service' && currentProvider"
                    [view]="providerInfoView"
                    [object]="currentProvider"></app-object-profile>

<app-services-list *ngIf="currentStep === 'service' && currentProvider"
                   [provider]="currentProvider"
                   [selectable]="true"
                   [closable]="false"
                   (selected)="serviceSelected($event.service)"></app-services-list>

<div *ngIf="currentStep === 'slots' && currentService" class="availability-calendar">
  <div class="calendar-header">
    <ion-button fill="clear"
                size="small"
                (click)="changeMonth(-1)"
                [disabled]="!canGoToPreviousMonth"
                aria-label="Mese precedente">
      <ion-icon *ngIf="canGoToPreviousMonth" name="chevron-back-outline"></ion-icon>
    </ion-button>
    <span class="calendar-title">{{ currentMonthLabel }}</span>
    <ion-button fill="clear" size="small" (click)="changeMonth(1)" aria-label="Mese successivo">
      <ion-icon name="chevron-forward-outline"></ion-icon>
    </ion-button>
  </div>

  <div class="calendar-grid calendar-weekdays">
    <span *ngFor="let weekDay of weekDays">{{ weekDay }}</span>
  </div>

  <div class="calendar-grid">
    <button *ngFor="let dayCell of calendarCells"
            type="button"
            class="calendar-day"
            [class.empty]="!dayCell"
            [class.selected]="dayCell?.isoDate === selectedCalendarDate"
            [class.disabled]="dayCell && !dayCell.selectable"
            [disabled]="!dayCell || !dayCell.selectable"
            (click)="selectCalendarDay(dayCell)">
      <span class="calendar-day-number">{{ dayCell?.date?.getDate() }}</span>
      <span *ngIf="dayCell?.selectable"
            class="calendar-dot"
            [class.level-none]="getAvailabilityLevel(dayCell.isoDate) === 'none'"
            [class.level-low]="getAvailabilityLevel(dayCell.isoDate) === 'low'"
            [class.level-medium]="getAvailabilityLevel(dayCell.isoDate) === 'medium'"
            [class.level-high]="getAvailabilityLevel(dayCell.isoDate) === 'high'"></span>
    </button>
  </div>
</div>

<div *ngIf="currentStep === 'slots' && currentService" style="display: flex">
  <ion-list *ngFor="let slotDay of slots | keyvalue">
    <ion-item>
      <span>{{ slotDay.key | date: 'EEEEEE dd/MM'}}</span>
    </ion-item>

    <ion-item *ngFor="let slot of slotDay.value; let j = index" lines="full" class="ion-text-center">
      <ion-button (click)="addReservation(slotDay.key, j)"
                  [disabled]="!hasRequiredConsecutiveSlots(slotDay.key, j)"
                  style="width: 100%">
        <ion-label>{{ slot }}</ion-label>
      </ion-button>
    </ion-item>
  </ion-list>
</div>

<div *ngIf="currentStep === 'summary' && reservationPreview" class="reservation-summary">
  <ion-card>
    <app-object-profile [view]="reservationConsultView" [object]="reservationPreview"></app-object-profile>
  </ion-card>

  <ion-button expand="block" color="primary" (click)="confirmReservation()">
    Conferma prenotazione
  </ion-button>
</div>
